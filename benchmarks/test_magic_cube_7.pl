:- par_create_parallel_engine('eng1',[team(localhost,2,'test_magic_cube_7.pl'),team(localhost,2,'test_magic_cube_7.pl'),team(localhost,2,'test_magic_cube_7.pl')]).

debug_query:- par_run_goal('eng1',magic(S),S),
              par_get_answers('eng1',exact(all),ListOfAnswers,NumOfAnswers),
              writeln(ListOfAnswers).


time_query:- statistics(walltime,[InitTime,_]),
             par_run_goal('eng1',magic(S),benchmark),
             statistics(walltime,[EndTime,_]),
             Time is EndTime - InitTime,
             write('time: '),write(Time),writeln(' ms').


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% --------                      ---------
%% |      |                      | 1 2 3 |
%% | L 5? |                      | 4 5 6 |
%% |      |                      | 7 8 9 |
%% ----------------------------- ---------------------------------
%% |      |      |      |      | | 1 2 3 | 1 2 3 | 1 2 3 | 1 2 3 |
%% | L 1? | L 2? | L 3? | L 4? | | 4 5 6 | 4 5 6 | 4 5 6 | 4 5 6 |
%% |      |      |      |      | | 7 8 9 | 7 8 9 | 7 8 9 | 7 8 9 |
%% ----------------------------- ---------------------------------
%% |      |                      | 7 8 9 |
%% | L 6? |                      | 4 5 6 |
%% |      |                      | 1 2 3 |
%% --------                      ---------
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

magic(S):- magic_go(7,S).

magic_go(N,S):- magic_problem(7,Y), magic_solve(N,Y,S).

magic_problem(6,[ [2,5,2,2,5,2,2,2,2],
                  [1,3,6,1,2,1,1,3,6],
                  [4,6,4,4,6,6,4,3,4],
                  [5,1,3,4,4,3,5,1,3],
                  [3,2,3,5,3,5,6,4,6],
                  [1,4,1,6,1,6,5,5,5] ]).

magic_problem(7,[ [2,3,3,1,5,5,5,3,3],
                  [6,3,5,2,2,5,6,6,2],
                  [4,6,1,4,6,6,6,6,5],
                  [4,1,5,4,4,5,2,4,3],
                  [6,3,1,2,3,5,3,4,4],
                  [1,1,1,1,1,2,4,2,2] ]).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

magic_movimento(1,0).
magic_movimento(2,1).
magic_movimento(3,2).
magic_movimento(4,3).
magic_movimento(5,4).
magic_movimento(6,5).
magic_movimento(7,6).

magic_solve(_,[ [1,1,1,1,1,1,1,1,1],
                [2,2,2,2,2,2,2,2,2],
                [3,3,3,3,3,3,3,3,3],
                [4,4,4,4,4,4,4,4,4],
                [5,5,5,5,5,5,5,5,5],
                [6,6,6,6,6,6,6,6,6] ],[]).

magic_solve(N,[ [L11,L12,L13,_,_,_,_,_,_],
                [L21,L22,L23,_,_,_,_,_,_],
                [L31,L32,L33,_,_,_,_,_,_],
                [L41,L42,L43,_,_,_,_,_,_],
                [L51,L52,L53,L54,_,L56,L57,L58,L59],
                [_,_,_,_,_,_,_,_,_] ], [dir1|L]):-
                magic_movimento(N,N1),
                magic_solve(N1,[ [L41,L42,L43,_,_,_,_,_,_],
                                 [L11,L12,L13,_,_,_,_,_,_],
                                 [L21,L22,L23,_,_,_,_,_,_],
                                 [L31,L32,L33,_,_,_,_,_,_],
                                 [L53,L56,L59,L52,_,L58,L51,L54,L57],
                                 [_,_,_,_,_,_,_,_,_] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [dir2|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L12,L13,L44,L45,L46,L17,L18,L19],
                 [L21,L22,L23,L14,L15,L16,L27,L28,L29],
                 [L31,L32,L33,L24,L25,L26,L37,L38,L39],
                 [L41,L42,L43,L34,L35,L36,L47,L48,L49],
                 [L53,L56,L59,L52,L55,L58,L51,L54,L57],
                 [L61,L62,L63,L64,L65,L66,L67,L68,L69] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [dir3|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L12,L13,L14,L15,L16,L47,L48,L49],
      		 [L21,L22,L23,L24,L25,L26,L17,L18,L19],
                 [L31,L32,L33,L34,L35,L36,L27,L28,L29],
                 [L41,L42,L43,L44,L45,L46,L37,L38,L39],
                 [L51,L52,L53,L54,L55,L56,L57,L58,L59],
                 [L63,L66,L69,L62,L65,L68,L61,L64,L67] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [lat1|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L67,L12,L13,L64,L15,L16,L61,L18,L19],
                 [L21,L22,L23,L24,L25,L26,L27,L28,L29],
                 [L31,L32,L57,L34,L35,L54,L37,L38,L51],
                 [L43,L46,L49,L42,L45,L48,L41,L44,L47],
                 [L11,L52,L53,L14,L55,L56,L17,L58,L59],
                 [L33,L62,L63,L36,L65,L66,L39,L68,L69] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [lat2|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L68,L13,L14,L65,L16,L17,L62,L19],
                 [L21,L22,L23,L24,L25,L26,L27,L28,L29],
                 [L31,L58,L33,L34,L55,L36,L37,L52,L39],
                 [L41,L42,L43,L44,L45,L46,L47,L48,L49],
                 [L51,L12,L53,L54,L15,L56,L57,L18,L59],
                 [L61,L32,L63,L64,L35,L66,L67,L38,L69] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [lat3|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L12,L69,L14,L15,L66,L17,L18,L63],
                 [L27,L24,L21,L28,L25,L22,L29,L26,L23],
                 [L59,L32,L33,L56,L35,L36,L53,L38,L39],
                 [L41,L42,L43,L44,L45,L46,L47,L48,L49],
                 [L51,L52,L13,L54,L55,L16,L57,L58,L19],
                 [L61,L62,L31,L64,L65,L34,L67,L68,L37] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [frn1|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L17,L14,L11,L18,L15,L12,L19,L16,L13],
                 [L57,L22,L23,L58,L25,L26,L59,L28,L29],
                 [L31,L32,L33,L34,L35,L36,L37,L38,L39],
                 [L41,L42,L67,L44,L45,L68,L47,L48,L69],
                 [L51,L52,L53,L54,L55,L56,L49,L46,L43],
                 [L61,L62,L63,L64,L65,L66,L27,L24,L21] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [frn2|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
                 [L21,L54,L23,L24,L55,L26,L27,L56,L29],
                 [L31,L32,L33,L34,L35,L36,L37,L38,L39],
                 [L41,L64,L43,L44,L65,L46,L47,L66,L49],
                 [L51,L52,L53,L48,L45,L42,L57,L58,L59],
                 [L61,L62,L63,L28,L25,L22,L67,L68,L69] ],L).

magic_solve(N,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
          [L21,L22,L23,L24,L25,L26,L27,L28,L29],
          [L31,L32,L33,L34,L35,L36,L37,L38,L39],
          [L41,L42,L43,L44,L45,L46,L47,L48,L49],
          [L51,L52,L53,L54,L55,L56,L57,L58,L59],
          [L61,L62,L63,L64,L65,L66,L67,L68,L69] ], [frn3|L]):-
      magic_movimento(N,N1),
      magic_solve(N1,[ [L11,L12,L13,L14,L15,L16,L17,L18,L19],
                 [L21,L22,L51,L24,L25,L52,L27,L28,L53],
                 [L33,L36,L39,L32,L35,L38,L31,L34,L37],
                 [L61,L42,L43,L62,L45,L46,L63,L48,L49],
                 [L47,L44,L41,L54,L55,L56,L57,L58,L59],
                 [L29,L26,L23,L64,L65,L66,L67,L68,L69] ],L).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

:- generate_indexing_code('test_magic_cube_7.pl','eng1',magic(X)).
